<div class="game-pt-category">
    <form action="game-ag.html" method="post">
        <input type="hidden" name="PageSize" value="21" />
        <input type="hidden" name="Type" value="PT" />
        <input type="hidden" name="category" value="" />
    </form>
</div>
<div class="game-pt" data-bind-action="/handler/game/gateway/gamelist" data-bind-type="list" data-bind-callback="list,game-pt" data-bind-load="search,pagesplit">
    <ul data-list-element="true">
        <li>
            <a href="javascript:userOpen('../controls/game-entry.html?Type=PT&Game=${Code}')" target="_blank">
                <img src="images/space.gif" style="background-image:url(${Cover});" />
                <span>${Name}</span>
            </a>
        </li>
    </ul>
    <div class="clear"></div>
</div>

<script type="text/javascript">
    BW.callback["game-pt"] = function (result) {
        var t = this;
        var parent = t.dom.element.getParent();
        var form = parent.getElement("form");

        if (form.getElements("a").length == 0) {
            var categoryValue = form.getElement("[name=category]")
            var category = result.info.data.List;
            category.unshift("");
            category.each(function (item) {
                new Element("a", {
                    "href": "javascript:",
                    "text": item == "" ? "全部" : item,
                    "class": item == "" ? "current" : "",
                    "data-value": item,
                    "events": {
                        "click": function () {
                            var current = form.getElements("a.current");
                            if (current == this) return;
                            categoryValue.set("value", this.get("data-value"));
                            this.addClass("current");
                            current.removeClass("current");
                            t.fire();
                        }
                    }
                }).inject(form);
            });
        }
    }
</script>