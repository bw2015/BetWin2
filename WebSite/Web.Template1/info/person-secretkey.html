<form action="person-secretkey.html" data-bind-action="handler/user/info/savesecretkey" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-form-tip="diag-close">
    <table class="post" data-bind-action="handler/user/info/getsecretkey" data-bind-type="ajax" data-bind-callback="person-secretkey">
        <tr>
            <th>二维码：</th>
            <td>
                <img src="images/space.gif" data-dom="code" />
            </td>
        </tr>
        <tr>
            <th>验证码：</th>
            <td>
                <input type="text" name="Code" class="txt w60 ft14" />
                <span class="desc">请填入扫描二维码之后生成的验证码内容</span>
            </td>
        </tr>
        <tr>
            <th></th>
            <td>
                <input type="hidden" name="Key" data-dom="key" />
                <input type="submit" value="保存" class="btn btn-blue" />
            </td>
        </tr>
    </table>
</form>
<script type="text/javascript">
    BW.callback["person-secretkey"] = function (result) {
        var t = this;
        if (!result.success) {
            new BW.Tip(result.msg, {
                "callback": function () {
                    BW.callback["diag-close"].apply(t);
                }
            });
            return;
        }

        t.dom.element.getElements("[data-dom]").each(function (item) {
            switch (item.get("data-dom")) {
                case "code":
                    item.set("src", result.info.Code.toQRCode());
                    break;
                case "key":
                    item.set("value", result.info.Key);
                    break;
            }
        });

    };
</script>