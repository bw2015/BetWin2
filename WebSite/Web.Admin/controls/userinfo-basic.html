       <!-- 用户基本信息 -->
<div class="userinfo-frame userinfo-basicinfo" data-bind-action="/admin/user/get" data-bind-type="ajax" data-bind-data="parent" data-bind-callback="html,userinfo-basicinfo,update">
    <table class="am-table am-table-bordered am-table-striped">
        <tr>
            <td colspan="4">
                <p class="am-alert am-alert-danger am-text-center">${remark}</p>
            </td>
        </tr>
        <tr>
            <td colspan="4" class="am-text-center">
                <label class="am-text-primary am-text-lg">${UserName}</label>
                <a href="javascript:" class="am-btn am-btn-success am-round am-text-xs am-fr" data-bind-action-delay="admin/user/removecache" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-data="parent" data-bind-stop="true" data-bind-event="click">刷新缓存</a>
                <label for="userinfo-isteset" class=" am-fr am-margin-right">
                    <input type="checkbox" name="IsTest" data-checked="${IsTest}" value="1" id="userinfo-isteset" data-type="switch" data-update-name="IsTest" data-update-userid="${ID}" data-update-action="admin/user/updateusertest" />
                    测试账户
                </label>
            </td>
        </tr>
        <tr>
            <td>
                <label>用户ID：</label> ${ID}
            </td>
            <td>
                <label>提款账户：</label> ${AccountName}
                <input data-type="AccountName" type="text" class="txt am-form-field w80" style="width:100px; display:inline-block;" value="${AccountName}" data-update-name="AccountName" data-update-userid="${ID}" data-update-action="admin/user/userinforeset" />
                <a data-type="AccountName" href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=AccountName&UserID=${ID}">重置</a>
            </td>
        </tr>
        <tr>
            <td>
                <label>会员类型：</label> ${UserType}
            </td>
            <td>
                <label>返点：</label><input type="number" value="${Rebate}" class="txt am-form-field w80" style="width:100px; display:inline-block;" data-update-name="Rebate" data-update-userid="${ID}" data-update-action="admin/user/userinforebate" />
            </td>
        </tr>
        <tr>
            <td>
                <label>手机号码：</label>
                ${Mobile}
                <input data-type="Mobile" type="text" class="txt am-form-field w80" style="width:100px; display:inline-block;" value="${Mobile}" data-update-name="Mobile" data-update-userid="${ID}" data-update-action="admin/user/userinforeset" />
                <a data-type="Mobile" href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=Mobile&UserID=${ID}">重置</a>
            </td>
            <td>
                <label>电子邮件：</label>${Email}
                <a data-type="Email" href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=Email&UserID=${ID}">重置</a>
            </td>
        </tr>
        <tr>
            <td><label>昵称：</label>${NickName}</td>
            <td>
                <label>QQ：</label>${QQ}
                <a data-type="QQ" href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=QQ&UserID=${ID}">重置</a>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                所属分组：
                <select name="GroupID" class="txt am-form-field" style="display:inline-block; width:auto;" data-bind-action="admin/user/grouplist" data-bind-type="ajax" data-bind-callback="select" data-select-value="ID" data-select-text="Name" data-selected="${GroupID}"></select>
                <a data-type="GroupID" href="javascript:" class="am-btn am-btn-default am-round am-text-xs">更改</a>
            </td>
        </tr>
        <tr>
            <td colspan="2" data-bind-update-action="admin/user/updatelockstatus">
                <label>锁定状态(${StatusName})：</label>
                <span data-type="lockstatus"></span>
                <span class="desc">选中即为锁定该操作类型</span>
            </td>
        </tr>
        <tr>
            <td colspan="2" data-bind-update-action="admin/user/updatefunctionstatus">
                <label>功能开放：</label>
                <span data-type="functionstatus"></span>
                <span class="desc">选中即为开放该功能</span>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <label>层级关系：</label>
                <span class="am-text-danger">${Agent}</span>
                <a href="javascript:" class="am-btn am-btn-primary am-text-xs am-round am-align-right" data-diag-name="userinfo-updateagent" data-diag-type="control" data-diag-src="controls/userinfo-updateagent.html" data-diag-title="修改${UserName}所属代理" data-diag-drag="true" data-diag-mask="true" data-diag-width="600" data-diag-height="400" data-diag-data="UserID=${ID}">修改上级</a>
            </td>
        </tr>
        <tr>
            <td><label>注册时间：</label> ${CreateAt}</td>
            <td><label>注册IP：</label> ${RegIP} (${RegIPAddress})</td>
        </tr>
        <tr>
            <td><label>登录时间：</label> ${LoginAt}</td>
            <td><label>登录IP：</label> ${LoginIP} (${LoginIPAddress})</td>
        </tr>
        <tr>
            <td colspan="4" class="am-text-center"><label>帐号安全</label></td>
        </tr>
        <tr>
            <td>
                <label>登录密码：</label>
                ${Password}
                <a href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=Password&UserID=${ID}">重置</a>
            </td>
            <td>
                <label>支付密码：</label>
                ${PayPassword}
                <a href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=PayPassword&UserID=${ID}">重置</a>
            </td>
        </tr>
        <tr>
            <td><label>银行卡绑定：</label> ${Bank}</td>
            <td>
                <label>谷歌验证码：</label>
                ${SecretKey}
                <a href="javascript:" class="am-btn am-btn-default am-round am-text-xs am-margin-left-xs" data-bind-action="admin/user/userinforeset" data-bind-type="ajax" data-bind-callback="form-tip" data-bind-event="confirm" data-bind-stop="true" data-bind-data="Name=SecretKey&UserID=${ID}">重置</a>
            </td>
        </tr>
        <tr>
            <td colspan="4" class="am-text-center"><label>帐户余额信息</label></td>
        </tr>
        <tr>
            <td><label>总资产：</label><strong class="am-text-danger">${TotalMoney:money}元</strong></td>
            <td><label>锁定金额：</label><strong class="am-text-danger">${LockMoney:money}元</strong></td>
        </tr>
        <tr>
            <td><label>可用余额：</label><strong class="am-text-danger">${Money:money}元</strong></td>
            <td>
                可提现额：<input type="number" class="txt am-form-field w80" style="width:100px; display:inline-block;" data-update-name="UpdateWithdraw" data-update-userid="${ID}" data-update-action="admin/user/updatewithdraw" value="${Withdraw}" />
            </td>
        </tr>
        <tr>
            <!--<td><label>投注总金额：</label><strong class="am-text-danger">${BetAmount:money}元</strong></td>-->
            <td><label>第三方钱包：</label><strong class="am-text-danger">${Wallet:money}元</strong></td>
            <td></td>
        </tr>
        <!--<tr>
            <td><label>存款总金额：</label><strong class="am-text-danger">${RechargeAmount:money}元</strong></td>
            <td><label>提款总金额：</label><strong class="am-text-danger">${WithdeawAmount:money}元</strong></td>
        </tr>-->
    </table>
</div>

<script type="text/javascript">
    // 基本资料绑定
    BW.callback["userinfo-basicinfo"] = function (result) {
        var t = this;
        var diag = t.dom.element.getParent(".diag");
        //diag.getElement("h3").set("text", result.info.UserName);
        var remark = t.dom.element.getElement(".am-alert");
        if (result.info.remark == "") {
            remark.getParent("tr").dispose();
        }
        t.dom.element.getElements("[data-type=AccountName],[data-type=Mobile]").each(function (item) {
            var name = item.get("data-type");
            if (result.info[name] == "") {
                if (item.get("tag") == "a") item.dispose();
            } else {
                if (item.get("tag") == "input") item.dispose();
            }
        });

        var lockstatus = t.dom.element.getElement("[data-type=lockstatus]");
        // 锁定状态
        result.info.Lock.each(function (item) {
            var id = "user-lock-" + result.info.ID + "-" + item.Name;
            var label = new Element("label", {
                "for": id,
                "text": " " + item.Description + " ",
                "class": "am-padding-right-lg"
            });
            new Element("input", {
                "type": "checkbox",
                "data-type": "switch",
                "value": 1,
                "name": item.Name,
                "data-update-name": item.Name,
                "data-update-id": result.info.ID,
                "checked": item.IsChecked == "1"
            }).inject(label, "top");
            label.inject(lockstatus);
        });

        var functionstatus = t.dom.element.getElement("[data-type=functionstatus]");
        // 开放的功能
        result.info.Function.each(function (item) {
            var id = "user-function-" + result.info.ID + "-" + item.Name;
            var label = new Element("label", {
                "for": id,
                "text": " " + item.Description + " ",
                "class": "am-padding-right-lg"
            });
            new Element("input", {
                "type": "checkbox",
                "data-type": "switch",
                "value": 1,
                "name": item.Name,
                "data-update-name": item.Name,
                "data-update-id": result.info.ID,
                "checked": item.IsChecked == "1"
            }).inject(label, "top");
            label.inject(functionstatus);
        });

        // 设置选中
        !function () {
            t.dom.container.getElements("input[data-checked]").each(function (item) {
                switch (item.get("data-checked")) {
                    case "true":
                    case "1":
                        item.set("checked", true);
                        break;
                }
            });
        }();

        // 设置分组
        !function () {
            var btn = t.dom.element.getElement("[data-type=GroupID]");
            var drp = t.dom.element.getElement("[name=GroupID]");
            if (!btn || !drp) return;
            btn.addEvent("click", function () {
                new Request.JSON({
                    "url": "admin/user/updategroup",
                    "onRequest": function () {
                        btn.fade("hide");
                        drp.set("disabled", true);
                    },
                    "onComplete": function () {
                        btn.fade("in");
                        drp.set("disabled", false);
                    },
                    "onSuccess": function (result) {
                        new BW.Tip(result.msg);
                    }
                }).post({
                    "GroupID": drp.get("value"),
                    "ID": result.info.ID
                })
            });
        }();

    }
</script>